  <!DOCTYPE html>
  <html lang="en">
  <head>
  <meta charset="UTF-8">
  <title>Report History</title>

  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #f4f6f8;
    }

    /* ---------- TOP NAVBAR (NEW) ---------- */
    .topbar {
      height: 60px;
      background: #0d47a1;
      color: #ffffff;
      display: flex;
      align-items: center;
      padding: 0 20px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }

    .topbar h4 {
      margin: 0;
      font-size: 18px;
    }

    .topbar span {
      margin-left: 10px;
      font-size: 14px;
      opacity: 0.9;
    }

    .topbar .right {
      margin-left: auto;
    }

    .topbar a {
      color: #ffffff;
      text-decoration: none;
      border: 1px solid #ffffff;
      padding: 6px 12px;
      border-radius: 6px;
      font-size: 14px;
    }

    .topbar a:hover {
      background: rgba(255,255,255,0.15);
    }

    /* ---------- MAIN LAYOUT ---------- */
    .layout {
      display: flex;
      height: calc(100vh - 60px); /* subtract navbar height */
    }

    /* LEFT SIDEBAR */
    .sidebar {
      width: 280px;
      background: #ffffff;
      border-right: 1px solid #ddd;
      padding: 10px;
      overflow-y: auto;
    }

    .sidebar h3 {
      margin: 10px 0;
    }

    .report-item {
      padding: 10px;
      margin-bottom: 8px;
      border-radius: 6px;
      cursor: pointer;
      border: 1px solid #eee;
    }

    .report-item:hover,
    .report-item.active {
      background: #e8f0ff;
    }

    /* CENTER + RIGHT PANELS */
    .panel {
      flex: 1;
      padding: 15px;
      overflow-y: auto;
    }

    .panel h3 {
      margin-top: 0;
    }

    .content-box {
      background: #ffffff;
      padding: 12px;
      border-radius: 6px;
      border: 1px solid #ddd;
      white-space: pre-wrap;
      min-height: 85%;
    }
      /* ---------- Sidebar Color Theme ---------- */

    /* Sidebar background */
    .sidebar {
      background: #f7f9fc; /* soft medical blue-grey */
    }

    /* Report item default */
    .report-item {
      background: #ffffff;
      border: 1px solid #e2e8f0;
      transition: background 0.2s ease, border 0.2s ease;
    }

    /* Hover effect */
    .report-item:hover {
      background: #eef4ff;
      border-color: #c7d8ff;
    }

    /* Active (selected) report */
    .report-item.active {
      background: #dbe9ff;
      border-left: 4px solid #0d47a1; /* brand blue */
      font-weight: 600;
    }

    /* Sidebar title */
    .sidebar h3 {
      color: #0d47a1;
      font-weight: 600;
    }

    /* Optional: scrollbar styling (nice polish) */
    .sidebar::-webkit-scrollbar {
      width: 6px;
    }

    .sidebar::-webkit-scrollbar-thumb {
      background: #cbd5e1;
      border-radius: 10px;
    }

    .sidebar::-webkit-scrollbar-track {
      background: transparent;
    }

    /* pdfbutton css */
    /* ---------- AI PDF DOWNLOAD BUTTON ---------- */
#downloadAiPdf {
  background: #ffffff;
  color: #0d47a1;
  border: 2px solid #ffffff;
  padding: 8px 14px;
  border-radius: 6px;
  font-size: 14px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.25s ease;
}

/* Hover effect */
#downloadAiPdf:hover {
  background: #e3f2fd;
  color: #0d47a1;
}

/* Click (active) effect */
#downloadAiPdf:active {
  transform: scale(0.96);
}

/* Focus (keyboard accessibility) */
#downloadAiPdf:focus {
  outline: none;
  box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.4);
}
  

  </style>
  </head>

  <body>

  <!-- ðŸ”µ NAVBAR (NEW) -->
  <div class="topbar">
    <h4>ðŸ©º Project-R</h4>
    <span>[AI-Powered Medical Report Analyzer]</span>

    <div class="right">
      <a href="index.html">Home Page</a>
    </div>

    <div class="right">
      <button id="downloadAiPdf">Download AI Summary PDF</button>
    </div>

  </div>


  
  <!-- ðŸ”¹ HISTORY LAYOUT -->
  <div class="layout">

    <!-- LEFT -->
    <div class="sidebar" id="reportList">
      <h3>Reports</h3>
    </div>

    <!-- CENTER -->
    <div class="panel">
      <h3>Extracted Text</h3>
      
      <!-- PDF ACTION BAR -->
      <div id="pdfSection" style="
        display:none;
        background:#ffffff;
        border-bottom:1px solid #ddd;
        padding:10px 20px;
        font-size:14px;
        display:flex;
        align-items:center;
        gap:15px;
      ">
        ðŸ“„ <strong id="pdfName"></strong>

        <a id="viewPdf"
          href="#"
          target="_blank"
          style="color:#0d47a1; text-decoration:none;">
          View
        </a>

        <a id="downloadPdf"
          href="#"
          download
          style="color:#0d47a1; text-decoration:none;">
          Download
        </a>
      </div>

      <div id="extractedText" class="content-box">
        Hello!!! please select the side history to view your report detail
      </div>
    </div>

    
    <!-- RIGHT -->
    <div class="panel">
      <h3>AI Summary</h3>
      <!-- PDF ACTION BAR -->
      
      <div id="aiSummary" class="content-box">
        Hello!!! please select the side history to view your AI details
      </div>
    </div>

  </div>

 <script>
  // ==============================
  // ELEMENT REFERENCES
  // ==============================
  const reportList = document.getElementById("reportList");
  const extractedTextDiv = document.getElementById("extractedText");
  const aiSummaryDiv = document.getElementById("aiSummary");

  const pdfSection = document.getElementById("pdfSection");
  const pdfNameSpan = document.getElementById("pdfName");
  const downloadPdfLink = document.getElementById("downloadPdf");
  const viewPdfLink = document.getElementById("viewPdf");

  const downloadAiBtn = document.getElementById("downloadAiPdf");

  // ==============================
  // LOAD REPORT HISTORY
  // ==============================
  fetch("http://127.0.0.1:5000/history")
    .then(res => res.json())
    .then(data => {
      reportList.innerHTML += "<h3>Reports</h3>";

      data.data.forEach(report => {
        const div = document.createElement("div");
        div.className = "report-item";
        div.innerHTML = `
          <strong>${report.pdf_name}</strong><br>
          <small>${report.created_at}</small>
        `;
        div.onclick = () => loadReport(report.id, div);
        reportList.appendChild(div);
      });
    })
    .catch(err => console.error("History load error:", err));

  // ==============================
  // LOAD SINGLE REPORT
  // ==============================
  function loadReport(id, element) {
    document.querySelectorAll(".report-item")
      .forEach(i => i.classList.remove("active"));
    element.classList.add("active");

    fetch(`http://127.0.0.1:5000/history/${id}`)
      .then(res => res.json())
      .then(data => {
        // Show extracted text & AI summary
        extractedTextDiv.textContent = data.data.extracted_text;
        aiSummaryDiv.textContent =
          data.data.ai_summary || "No AI summary available";

        // Original PDF actions
        const pdfUrl =
          `http://127.0.0.1:5000/download/${data.data.pdf_name}`;

        pdfNameSpan.textContent = data.data.pdf_name;
        viewPdfLink.href = pdfUrl;
        downloadPdfLink.href = pdfUrl;

        pdfSection.style.display = "flex";
      })
      .catch(err => console.error("Report load error:", err));
  }

  // ==============================
  // DOWNLOAD AI SUMMARY AS PDF
  // ==============================
  if (downloadAiBtn) {
    downloadAiBtn.addEventListener("click", () => {

      const aiText = aiSummaryDiv.textContent.trim();

      if (!aiText || aiText.startsWith("Hello")) {
        alert("No AI summary available to download.");
        return;
      }

      fetch("http://127.0.0.1:5000/generate-pdf", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ result: aiText })
      })
      .then(res => res.blob())
      .then(blob => {
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "AI_Summary.pdf";
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      })
      .catch(err => console.error("AI PDF error:", err));
    });
  }
</script>


  </body>
  </html>
